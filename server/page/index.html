<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- Последняя компиляция и сжатый CSS -->
    <link rel="stylesheet" href="bootstrap-theme.min.css">

    <!-- Дополнение к теме -->
    <link rel="stylesheet" href="bootstrap.min.css">
</head>
<body>
<h1>sdfjs</h1>

<h3>File Upload:</h3>
Select a file to upload: <br />

<form action = "http://localhost:3000/file_upload" method = "POST" id="uploadForm" enctype = "multipart/form-data">
    <input type="file" name="file" size="50" />
    <br />
    <select id="typeSheet" name="sheet">
        <option value="0">АНОНС</option>
        <option value="1">ВЕЛОСИПЕДЫ</option>
        <option value="2">СПОРТ_ТУРИЗМ</option>
        <option value="3">ЗАПЧАСТИ</option>
        <option value="4">ИГРУШКА</option>
        <option value="5">ИТОГ</option>
        <option value="6">ОБЩИЙ_ЗАКАЗ</option>
        <option value="7">наличие на складе</option>
    </select>
    <br/>
    <input type = "button" id="get" value = "Upload File" />
</form>
<span id = "status">asd</span>

<button id="test">defsds</button>
<img id="img"/>

<div class="container">
    <h4>Сколько показывать</h4>
    <div class="form-group">
        <select name="state" id="maxRows" class="form-control" style="width: 150px">
            <option selected value="5">5</option>
            <option value="10">10</option>
            <option value="50">50</option>
            <option value="100">100</option>
            <option value="500" id="all">Show All</option>
        </select>

        <button id="send">Проверить</button>
        <div id="output"></div>
    </div>
    <table id="myTable" class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Артикул</th>
                <th>Картинка</th>
                <th>Производитель</th>
                <th>Наименование</th>
                <th>Цена с НДС</th>
                <th>Характеристики</th>
            </tr>
        </thead>
        <tbody id="data">
        </tbody>
    </table>

<div class="pagination-container">
    <nav>
        <ul class="pagination"></ul>
    </nav>
</div>
</div>

<!-- Последняя компиляция и сжатый JavaScript -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script>
var allData = null;
    $(document).ready(function() {
        $('#get').click(function () {
            alert('z nen');
            // var sheet = document.getElementById("typeSheet");
            // console.log(sheet);
            var fd = new FormData(document.getElementById("uploadForm"));
            // fd.append('sheet', sheet);
            console.log(fd.get('sheet'));
            $.ajax({
                url: '/file_upload',
                data: fd,
                method: 'POST',
                processData: false,
                contentType: false,
                success: function (data) {
                    allData = data;
                    var ro = $("#maxRows option");
                    var test = ro[ro.length - 1].value = data.length;
                    console.log(test);
                    var counter = 0;

                    var table = document.getElementById('data');
                    // alert(Object.keys(data[0]).length);
                    for (var i = 0; i < data.length; i++) {
                        if (data[i] != null && Object.keys(data[i]).length > 10) {
                            var tr = document.createElement('tr');
                            tr.className = 'headline';
                            var tdImage = document.createElement('td');
                            var tdMark = document.createElement('td');
                            var tdType = document.createElement('td');
                            var tdCost = document.createElement('td');
                            var tdArticul = document.createElement('td');
                            tdArticul.className = 'ss';
                            var tdAbout = document.createElement('td');

                            var image = document.createElement('div');
                            // image.className = 'img-thumbnail';
                            // image.style = 'width:18rem';
                            if (data[i]['ССЫЛКА']) {
                                image.innerText = 'Картинка есть';
                            } else {
                                image.innerText = 'Картинки нет';
                            }

                            var divImage = document.createElement('div');
                            divImage.appendChild(image);
                            // var text1 = document.createTextNode(data[0]['БЕЗНАЛ']);
                            var textMark = document.createTextNode(data[i]['ТОРГОВАЯ МАРКА']);
                            var textType = document.createTextNode(data[i]['НАИМЕНОВАНИЕ']);
                            var textCost = document.createTextNode(data[i]['ЦЕНА С НДС - предоплата, BYN']);
                            var textAbout = document.createTextNode(data[i]['ХАРАКТЕРИСТИКИ']);
                            var textArtikul = document.createTextNode(data[i]['АРТИКУЛ']);

                            tdImage.appendChild(divImage);
                            tdMark.appendChild(textMark);
                            tdType.appendChild(textType);
                            tdCost.appendChild(textCost);
                            tdArticul.appendChild(textArtikul);
                            tdAbout.appendChild(textAbout);
                            tr.appendChild(tdArticul);
                            tr.appendChild(tdImage);
                            tr.appendChild(tdMark);
                            tr.appendChild(tdType);
                            tr.appendChild(tdCost);
                            tr.appendChild(tdAbout);

                            table.appendChild(tr);
                        } else {
                            // data.splice(i, 1);
                            counter++;

                        }
                    }

                    alert(counter + ' = не праильных');

                    $(function () {
                        $('table tr:eq(0)').prepend('<th>ID</th>');
                        var id = 0;
                        $('table tr:gt(0)').each(function () {
                            id++;

                            $(this).prepend('<td>' + id + '<input type="checkbox"/></td>');
                        });
                    });

                    $('#myTable').show();
                    // allData = data;
                }
            });
        });
    });
console.log(allData);
    ////////////////
var table = '#myTable';
$('#maxRows').on('change', function () {
    $('.pagination').html('');
    var trNum = 0;
    var maxRows = parseInt($(this).val());
    var totalRows = $(table + ' tbody tr').length;
    $(table + ' tr:gt(0)').each(function () {
        trNum++;
        if (trNum > maxRows){
            $(this).hide();
        }
        if (trNum <= maxRows){
            $(this).show();
        }
    });
    if (totalRows > maxRows){
        var pagenum = Math.ceil(totalRows/maxRows);
        for (var i = 1; i <= pagenum;){
            $('.pagination').append('<li data-page="' + i + '">\<span>' + i++ + '<span class="sr-only">(current)</span></span>\</li>').show();
        }
    }
    $('.pagination li:first-child').addClass('active');
    $('.pagination li').on('click', function () {
        var pageNum = $(this).attr('data-page');
        var trIndex = 0;
        $('.pagination li').removeClass('active');
        $(this).addClass('active');
        $(table + ' tr:gt(0)').each(function () {
            trIndex++;
            if (trIndex > (maxRows * pageNum) || trIndex <= ((maxRows * pageNum) - maxRows)) {
                $(this).hide();
            } else {
                $(this).show();
            }
        });
    });
});
$('#myTable').hide();
    // Инициализация при загрузке страницы

    // var tbl = $('#myTable'),
    //     chbx,
    //     tds;
    //
    // $('button').on('click', function(){
    //     var chbx = $(':checkbox:checked',tbl),
    //         vals = [];
    //     if(!chbx.length) return false;
    //     chbx.each(function(i,el){
    //         tds = $(el).find('td');
    //         vals.push(tds.map(function(i,el){
    //             return $(el).text();
    //         }).get());
    //     });
    //     console.log(vals);
    //     $('#output').text('Данные строк: ' + vals);
    // });

    $('button').click(function(){
        console.log(allData);
        var vals = [];
        var tmp = null;
        $('#myTable tr').filter(':has(:checkbox:checked)').find('.ss').each(function() {
            //get row values

            vals.push($(this).map(function(i,el){
                            return $(el).text();
                        }).get());
            $('#output').append($(this).text());

        });
        $.ajax({
            url: '/get_file',
            data: JSON.stringify(vals),
            method: 'POST',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                tmp = data;
            }
        });
        console.log(vals);
        console.log(tmp);
    });
</script>
</body>
</html>